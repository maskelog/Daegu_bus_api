# 대구 버스 API 서버

이 API 서버는 대구시 버스 관련 정보를 제공하며, 다음의 주요 기능을 포함합니다.

- **노선 검색**: 입력한 텍스트를 기반으로 노선(버스번호 및 부가 정보)을 검색합니다.
- **노선 조회**: 노선 고유 ID를 통해 해당 노선의 정류장 목록 및 실시간 버스 위치 정보를 조회합니다.
- **정류장 검색**: 입력한 텍스트를 기반으로 정류장을 검색합니다.
- **정류장 정보 조회**: 정류장 고유 ID를 기반으로 해당 정류장에 도착하는 버스 정보를 조회합니다.
- **정류장 도착 정보 조회 (쿼리 방식)**:  
  쿼리 파라미터로 **bsNm**(정류장 이름)와 **wincId**(정류장 번호) 중 하나 또는 둘 다 입력하면, 캐시 파일(stations.json)에서 해당 정류장을 찾아 그 정류장의 도착 버스 정보를 조회합니다.
- **실시간 버스 위치 조회**: 노선 고유 ID를 통해 실시간 버스 위치 정보를 XML → JSON 형식으로 조회합니다.

## 엔드포인트

### 1. 노선 관련 API

#### 노선 검색

**GET** `/route/search/:text`

- **설명**: 입력한 텍스트를 기반으로 노선을 검색합니다.
- **예시**:
  ```
  GET /route/search/52
  ```
- **응답 예시**:
  ```json
  [
    { "name": "523", "sub": "원대오거리방면", "id": "3000523000" },
    { "name": "523", "sub": "동산네거리방면", "id": "3000523001" },
    { "name": "524", "sub": "default", "id": "3000524000" },
    { "name": "527", "sub": "default", "id": "3000527000" }
  ]
  ```

#### 노선 조회

**GET** `/route/:id`

- **설명**: 노선 고유 ID를 통해 해당 노선의 정류장 목록 및 실시간 버스 위치 정보를 조회합니다.
- **예시**:
  ```
  GET /route/4050003000
  ```
- **응답 예시**:
  ```json
  {
    "Result": {
      "header": {
        "success": "true",
        "resultCode": "0000",
        "resultMsg": "성공"
      },
      "body": [
        {
          "bsId": "7011030000",
          "bsNm": "부동(종점)",
          "wincId": "03543",
          "ngisXPos": "172447.922398",
          "ngisYPos": "365798.267499",
          "lng": "128.69484815",
          "lat": "35.8892428",
          "moveDir": "0",
          "seq": "1.0",
          "style": "bs"
        },
        ...
        {
          "bsId": "7011020500",
          "bsNm": "농협방촌지점",
          "wincId": "20660",
          "ngisXPos": "169808.41863547",
          "ngisYPos": "365021.75768406",
          "lng": "128.66564428333334",
          "lat": "35.88216678333333",
          "moveDir": "1",
          "seq": "20.0",
          "style": "bs"
        },
        {
          "bsId": "7011049200",
          "bsNm": "대구선방촌공원",
          "wincId": "20659",
          "ngisXPos": "170181.0635",
          "ngisYPos": "364872.163",
          "lng": "128.66977666666668",
          "lat": "35.88083",
          "moveDir": "1",
          "seq": "21.0",
          "style": "bs"
        },
        {
          "bsId": "7011048400",
          "bsNm": "해안동행정복지센터",
          "wincId": "03159",
          "ngisXPos": "170412.6313",
          "ngisYPos": "365033.8725",
          "lng": "128.67233506666668",
          "lat": "35.8822944",
          "moveDir": "1",
          "seq": "22.0",
          "style": "bs"
        },
        {
          "bsId": "7011029900",
          "bsNm": "부동삼거리",
          "wincId": "01592",
          "ngisXPos": "171025.85096744",
          "ngisYPos": "365726.19361345",
          "lng": "128.67910166666667",
          "lat": "35.888551666666665",
          "moveDir": "1",
          "seq": "23.0",
          "style": "bs"
        },
        {
          "bsId": "7011030000",
          "bsNm": "부동(종점)",
          "wincId": "03543",
          "ngisXPos": "172447.922398",
          "ngisYPos": "365798.267499",
          "lng": "128.69484815",
          "lat": "35.8892428",
          "moveDir": "1",
          "seq": "24.0",
          "style": "bs"
        }
        // ... 기타 노선 그룹
      ]
    }
  }
  ```

### 2. 정류장 관련 API

- **정류장 검색**  
  **GET** `/station/search/:text`

  - **설명**: 입력한 텍스트(정류장 이름)를 기반으로 정류장을 검색합니다. HTML 파싱을 통해 결과를 반환합니다.
  - **예시**:
    ```
    GET /station/search/동대구역건너
    ```

- **정류장 정보 조회**  
  **GET** `/station/:id`

  - **설명**: 정류장 고유 ID를 통해 해당 정류장의 도착 버스 정보를 조회합니다.
  - **예시**:
    ```
    GET /station/7001010500
    ```

- **정류장 도착 정보 조회 (쿼리 방식)**  
  **GET** `/api/arrival`
  - **설명**: 쿼리 파라미터로 **bsNm**(정류장 이름)와 **wincId**(정류장 번호) 중 하나 또는 둘 다 입력하면,  
    캐시 파일(stations.json)에서 해당 정류장을 찾아 그 정류장의 도착 버스 정보를 외부 API에서 조회 후 변환하여 반환합니다.
  - **요청 예시**:
    - `GET http://localhost:8080/api/arrival?bsNm=대구역건너&wincId=20022`
    - 또는 `GET http://localhost:8080/api/arrival?bsNm=대구역건너`
  - **응답 예시**:
    ```json
    {
      "station": {
        "bsId": "7001010500",
        "bsNm": "대구역건너",
        "wincId": "20022",
        "routeList": "101-1, 401, 618, 651, 708, 802, 가창2",
        "ngisXPos": "163650.97457894",
        "ngisYPos": "364186.02776498",
        "bsBit": "bit",
        "style": "bs",
        "seq": 1429
      },
      "arrival": [
        {
          "name": "708",
          "sub": "default",
          "id": "3000708002",
          "forward": "1",
          "bus": [
            {
              "버스번호": "1620(저상)",
              "현재정류소": "신암2동우체국",
              "남은정류소": "4 개소",
              "도착예정소요시간": "8분"
            },
            {
              "버스번호": "2317(일반)",
              "현재정류소": "대구도시개발공사앞",
              "남은정류소": "12 개소",
              "도착예정소요시간": "22분"
            }
          ]
        },
        {
          "name": "동구3",
          "sub": "default",
          "id": "4050003001",
          "forward": "0",
          "bus": [
            {
              "버스번호": "3417(일반)",
              "현재정류소": "공고네거리1",
              "남은정류소": "6 개소",
              "도착예정소요시간": "8분"
            },
            {
              "버스번호": "3411(일반)",
              "현재정류소": "대구선방촌공원남편",
              "남은정류소": "20 개소",
              "도착예정소요시간": "30분"
            }
          ]
        }
        // ... 기타 노선 그룹
      ]
    }
    ```

### 3. 기존 API

- **버스 도착 정보 조회 (원본)**  
  **GET** `/api/arrival/:stationId`

  - **설명**: 정류장 고유 ID를 이용해 외부 API로부터 도착 버스 정보를 원본 형식(JSON) 그대로 반환합니다.

- **실시간 버스 위치 조회 (원본)**  
  **GET** `/api/pos`
  - **설명**: 노선 고유 ID를 쿼리 파라미터로 받아, 해당 노선의 실시간 버스 위치 정보를 XML → JSON 형식으로 반환합니다.
  - **예시**:
    ```
    GET /api/pos?routeId=3000623002
    ```
